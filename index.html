<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tsuchiura Sound Archive</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
  html,body{height:100%;margin:0;background:#0c0f13;color:#e8e0c9;}
  #map{height:100vh;}
  .brand{position:fixed;left:12px;bottom:12px;padding:6px 10px;background:#111a;
    color:#f0d27a;border:1px solid #f0d27a55;border-radius:999px;font-size:12px;}
  .hud{position:fixed;right:12px;top:12px;background:#111a;color:#f0d27a;
    border:1px solid #f0d27a55;font:12px/1.2 system-ui;padding:8px 10px;border-radius:10px;}
</style>
</head>
<body>
<div id="map"></div>
<div class="brand">Tsuchiura Archive</div>
<div class="hud">ğŸ“ x:<span id="px">â€”</span> / y:<span id="py">â€”</span></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  // ç”»åƒã¯ãƒªãƒã‚¸ãƒˆãƒªç›´ä¸‹
  const IMG_URL = './tsuchiura_map.jpg';

  // ç”»åƒã‚’èª­ã¿è¾¼ã‚“ã§ naturalWidth/Height ã‚’ä½¿ã†ï¼ˆã‚µã‚¤ã‚ºãšã‚Œé˜²æ­¢ï¼‰
  const img = new Image();
  img.onload = () => {
    const IMG_WIDTH  = img.naturalWidth;
    const IMG_HEIGHT = img.naturalHeight;

    const bounds = [[0,0],[IMG_HEIGHT,IMG_WIDTH]];
    const map = L.map('map',{ crs:L.CRS.Simple, minZoom:-2, maxZoom:2, zoomControl:true });
    L.imageOverlay(IMG_URL, bounds).addTo(map);
    map.fitBounds(bounds);
    map.setMaxBounds(bounds);

    const toLatLng = (x,y)=> map.unproject([x,y], map.getMaxZoom());
    const toPixel  = (ll)=> map.project(ll, map.getMaxZoom());

    map.on('click', e=>{
      const pt = toPixel(e.latlng);
      px.textContent = Math.round(pt.x);
      py.textContent = Math.round(pt.y);
      L.circleMarker(e.latlng,{radius:4,color:'#f0d27a',weight:1,fill:true,fillOpacity:.6})
        .addTo(map).bindTooltip(`x:${Math.round(pt.x)} / y:${Math.round(pt.y)}`).openTooltip();
    });

    // ã“ã“ã«ã‚¹ãƒãƒƒãƒˆã‚’è¿½åŠ ã—ã¦ã„ã‘ã¾ã™
    const SPOTS = [
      // ä¾‹:
      // { title:'å™´æ°´', x:980, y:560, recorder:'Aoi', date:'2025-10-12',
      //   photo:'assets/img/funsui.jpg', audio:'assets/audio/funsui.mp3', description:'å…¬åœ’ä¸­å¤®ã®å™´æ°´' }
    ];
    const icon = L.icon({
      iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",
      shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png",
      iconSize:[25,41], iconAnchor:[12,41], popupAnchor:[1,-34]
    });
    SPOTS.forEach(s=>{
      const ll = toLatLng(s.x, s.y);
      const html = `<div class="popup">
        ${s.photo?`<img src="${s.photo}" alt="${s.title}" style="width:100%;border-radius:10px;margin-bottom:8px">`:``}
        <div style="font-size:12px;color:#555;margin:6px 0">${s.title} ï½œ REC: ${s.recorder} ï½œ ${s.date}</div>
        <div>${s.description||''}</div>
        ${s.audio?`<audio controls preload="metadata" src="${s.audio}" style="width:100%;margin-top:6px"></audio>`:``}
      </div>`;
      L.marker(ll,{icon}).addTo(map).bindPopup(html);
    });
  };
  img.onerror = () => {
    document.body.insertAdjacentHTML('beforeend','<p style="padding:16px;color:#f88">ç”»åƒãŒèª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸï¼š'+IMG_URL+'</p>');
  };
  img.src = IMG_URL;
</script>
</body>
</html>
